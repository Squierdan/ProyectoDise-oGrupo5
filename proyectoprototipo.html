<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	
</body>
</html>
<script>
// SGSPI-EPN Prototype - Complete Frontend Implementation
// localStorage-based demo with role-based dashboards

const app = {
  users: {
    admin: { id: 1, name: 'Admin User', email: 'admin@epn.edu.ec', role: 'admin', faculty: 'Ingeniería' },
    docente: { id: 2, name: 'Dr. García', email: 'garcia@epn.edu.ec', role: 'docente' },
    estudiante: { id: 3, name: 'Juan Pérez', email: 'juan.perez@epn.edu.ec', role: 'estudiante', carrera: 'Ing. Sistemas', semester: 5 }
  },
  projects: [
    { id: 101, name: 'IA en Educación', director: 'garcia@epn.edu.ec', code: 'PRY-001', status: 'active', faculty: 'Ingeniería', students: [3], deadline: '2024-02-28' },
    { id: 102, name: 'Análisis de Datos', director: 'garcia@epn.edu.ec', code: 'PRY-002', status: 'active', faculty: 'Ingeniería', students: [], deadline: '2024-03-15' }
  ],
  whitelist: ['juan.perez@epn.edu.ec'],
  reports: [
    { id: 1, projectId: 101, studentId: 3, status: 'submitted', date: '2024-01-15', file: 'informe_enero.pdf' }
  ],
  currentUser: null,

  init() {
    this.loadData();
    this.render();
  },

  loadData() {
    const saved = localStorage.getItem('sgspi_data');
    if (saved) {
      Object.assign(this, JSON.parse(saved));
    }
  },

  saveData() {
    localStorage.setItem('sgspi_data', JSON.stringify(this));
  },

  login(email, password) {
    const user = Object.values(this.users).find(u => u.email === email);
    if (user) {
      this.currentUser = user;
      this.saveData();
      this.render();
      return true;
    }
    return false;
  },

  logout() {
    this.currentUser = null;
    this.saveData();
    this.render();
  },

  registerStudent(email, name, cedula, carrera, semester) {
    if (!this.whitelist.includes(email)) {
      return { success: false, msg: 'Email no autorizado' };
    }
    const id = Math.max(...Object.keys(this.users).map(k => this.users[k].id || 0)) + 1;
    this.users[id] = { id, name, email, role: 'estudiante', carrera, semester, cedula };
    this.whitelist = this.whitelist.filter(w => w !== email);
    this.saveData();
    return { success: true };
  },

  inviteStudent(projectId, studentEmail) {
    if (!this.whitelist.includes(studentEmail)) {
      this.whitelist.push(studentEmail);
    }
    this.saveData();
  },

  submitReport(projectId, studentId, file) {
    this.reports.push({ id: this.reports.length + 1, projectId, studentId, status: 'submitted', date: new Date().toLocaleDateString(), file });
    this.saveData();
  },

  render() {
    const app = document.getElementById('app');
    app.innerHTML = this.currentUser ? this.renderDashboard() : this.renderLogin();
  },

  renderLogin() {
    return `
      <div class="login-container">
        <h1>SGSPI-EPN</h1>
        <p>Sistema de Gestión de Proyectos de Investigación</p>
        <form onsubmit="app.handleLogin(event)">
          <input type="email" id="email" placeholder="Correo institucional" required>
          <input type="password" id="password" placeholder="Contraseña" required>
          <button type="submit">Iniciar Sesión</button>
        </form>
        <p><a href="#" onclick="app.showRegister()">Registrar como Estudiante</a></p>
        <div id="register-form" style="display:none; margin-top: 20px; border: 1px solid #ddd; padding: 20px;">
          <h3>Registro de Estudiante</h3>
          <form onsubmit="app.handleRegister(event)">
            <input type="email" id="reg-email" placeholder="Correo institucional (@epn.edu.ec)" required>
            <input type="text" id="reg-name" placeholder="Nombres y Apellidos" required>
            <input type="text" id="reg-cedula" placeholder="Cédula/Pasaporte" required>
            <input type="text" id="reg-carrera" placeholder="Carrera" required>
            <input type="number" id="reg-semester" placeholder="Semestre" required>
            <input type="password" id="reg-password" placeholder="Contraseña" required>
            <button type="submit">Registrarse</button>
            <button type="button" onclick="app.hideRegister()">Cancelar</button>
          </form>
        </div>
      </div>
    `;
  },

  renderDashboard() {
    const user = this.currentUser;
    let content = '';
    if (user.role === 'estudiante') content = this.renderStudentDashboard();
    else if (user.role === 'docente') content = this.renderTeacherDashboard();
    else if (user.role === 'admin') content = this.renderAdminDashboard();
    return `
      <div class="dashboard">
        <header>
          <h1>SGSPI-EPN</h1>
          <div class="user-info">${user.name} (${user.role}) <button onclick="app.logout()">Cerrar Sesión</button></div>
        </header>
        <main>${content}</main>
      </div>
    `;
  },

  renderStudentDashboard() {
    const student = this.currentUser;
    const myProjects = this.projects.filter(p => p.students.includes(student.id));
    const myReports = this.reports.filter(r => r.studentId === student.id);
    return `
      <h2>Mi Dashboard - Estudiante</h2>
      <section>
        <h3>Mis Proyectos</h3>
        ${myProjects.length ? myProjects.map(p => `
          <div class="card">
            <h4>${p.name} (${p.code})</h4>
            <p>Estado: ${p.status}</p>
            <p>Deadline: ${p.deadline}</p>
            <button onclick="app.showSubmitReport(${p.id})">Cargar Informe</button>
          </div>
        `).join('') : '<p>No tienes proyectos asignados</p>'}
      </section>
      <section>
        <h3>Mis Informes</h3>
        ${myReports.length ? myReports.map(r => `
          <div class="card">
            <p>Archivo: ${r.file}</p>
            <p>Estado: <span class="badge">${r.status}</span></p>
            <p>Fecha: ${r.date}</p>
          </div>
        `).join('') : '<p>No hay informes cargados</p>'}
      </section>
      <div id="submit-report-form" style="display:none; margin-top: 20px; border: 1px solid #ddd; padding: 20px;">
        <h3>Cargar Informe</h3>
        <form onsubmit="app.handleReportSubmit(event)">
          <input type="hidden" id="project-id">
          <input type="file" id="report-file" accept=".pdf,.doc,.docx" required>
          <button type="submit">Enviar</button>
          <button type="button" onclick="app.hideSubmitReport()">Cancelar</button>
        </form>
      </div>
    `;
  },

  renderTeacherDashboard() {
    const teacher = this.currentUser;
    const myProjects = this.projects.filter(p => p.director === teacher.email);
    return `
      <h2>Mi Dashboard - Docente</h2>
      <section>
        <h3>Mis Proyectos</h3>
        ${myProjects.length ? myProjects.map(p => `
          <div class="card">
            <h4>${p.name} (${p.code})</h4>
            <p>Estudiantes: ${p.students.length}</p>
            <p>Deadline: ${p.deadline}</p>
            <button onclick="app.showInviteStudent(${p.id})">Invitar Estudiante</button>
            <button onclick="app.viewProjectReports(${p.id})">Ver Informes</button>
          </div>
        `).join('') : '<p>No tienes proyectos</p>'}
      </section>
      <div id="invite-form" style="display:none; margin-top: 20px; border: 1px solid #ddd; padding: 20px;">
        <h3>Invitar Estudiante</h3>
        <form onsubmit="app.handleInvite(event)">
          <input type="hidden" id="invite-project-id">
          <input type="email" id="invite-email" placeholder="Email del estudiante" required>
          <button type="submit">Enviar Invitación</button>
          <button type="button" onclick="app.hideInviteForm()">Cancelar</button>
        </form>
      </div>
      <div id="reports-view" style="display:none; margin-top: 20px;"></div>
    `;
  },

  renderAdminDashboard() {
    return `
      <h2>Panel de Administración</h2>
      <section>
        <h3>Buscador Avanzado</h3>
        <input type="text" id="search-input" placeholder="Buscar por nombre, código o director" onkeyup="app.filterProjects()">
        <div id="search-results">
          ${this.projects.map(p => `
            <div class="card">
              <h4>${p.name} (${p.code})</h4>
              <p>Director: ${p.director}</p>
              <p>Facultad: ${p.faculty}</p>
              <p>Estudiantes: ${p.students.length}</p>
              <button onclick="app.viewProjectDetails(${p.id})">Detalles</button>
            </div>
          `).join('')}
        </div>
      </section>
      <section>
        <h3>Monitoreo de Usuarios</h3>
        <table>
          <tr><th>Nombre</th><th>Email</th><th>Rol</th><th>Última Conexión</th></tr>
          ${Object.values(this.users).map(u => `
            <tr><td>${u.name}</td><td>${u.email}</td><td>${u.role}</td><td>Ahora</td></tr>
          `).join('')}
        </table>
      </section>
    `;
  },

  handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    if (this.login(email, password)) {
      alert('Sesión iniciada');
    } else {
      alert('Credenciales inválidas');
    }
  },

  handleRegister(e) {
    e.preventDefault();
    const result = this.registerStudent(
      document.getElementById('reg-email').value,
      document.getElementById('reg-name').value,
      document.getElementById('reg-cedula').value,
      document.getElementById('reg-carrera').value,
      parseInt(document.getElementById('reg-semester').value)
    );
    if (result.success) {
      alert('Registro exitoso. Inicia sesión');
      this.hideRegister();
      document.getElementById('email').value = document.getElementById('reg-email').value;
    } else {
      alert(result.msg);
    }
  },

  handleReportSubmit(e) {
    e.preventDefault();
    const file = document.getElementById('report-file').value.split('\\').pop();
    this.submitReport(parseInt(document.getElementById('project-id').value), this.currentUser.id, file);
    alert('Informe cargado');
    this.hideSubmitReport();
    this.render();
  },

  handleInvite(e) {
    e.preventDefault();
    this.inviteStudent(parseInt(document.getElementById('invite-project-id').value), document.getElementById('invite-email').value);
    alert('Invitación enviada');
    this.hideInviteForm();
  },

  showSubmitReport(projectId) {
    document.getElementById('project-id').value = projectId;
    document.getElementById('submit-report-form').style.display = 'block';
  },

  hideSubmitReport() {
    document.getElementById('submit-report-form').style.display = 'none';
  },

  showRegister() {
    document.getElementById('register-form').style.display = 'block';
  },

  hideRegister() {
    document.getElementById('register-form').style.display = 'none';
  },

  showInviteStudent(projectId) {
    document.getElementById('invite-project-id').value = projectId;
    document.getElementById('invite-form').style.display = 'block';
  },

  hideInviteForm() {
    document.getElementById('invite-form').style.display = 'none';
  },

  viewProjectReports(projectId) {
    const reports = this.reports.filter(r => r.projectId === projectId);
    const html = reports.length ? reports.map(r => `<p>${r.file} - ${r.status}</p>`).join('') : '<p>Sin informes</p>';
    document.getElementById('reports-view').innerHTML = html;
    document.getElementById('reports-view').style.display = 'block';
  },

  filterProjects() {
    const term = document.getElementById('search-input').value.toLowerCase();
    const filtered = this.projects.filter(p => p.name.toLowerCase().includes(term) || p.code.includes(term) || p.director.includes(term));
    document.getElementById('search-results').innerHTML = filtered.map(p => `
      <div class="card">
        <h4>${p.name} (${p.code})</h4>
        <p>Director: ${p.director}</p>
        <p>Facultad: ${p.faculty}</p>
        <p>Estudiantes: ${p.students.length}</p>
      </div>
    `).join('');
  },

  viewProjectDetails(projectId) {
    alert('Detalles del proyecto ' + projectId);
  }
};

// Initialize on load
window.addEventListener('load', () => app.init());
</script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

#app {
  width: 100%;
  max-width: 1200px;
}

.login-container {
  background: white;
  border-radius: 10px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  padding: 40px;
  text-align: center;
  max-width: 400px;
  margin: 0 auto;
}

.login-container h1 {
  color: #667eea;
  margin-bottom: 10px;
  font-size: 28px;
}

.login-container p {
  color: #999;
  margin-bottom: 30px;
}

.login-container form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

input[type="email"],
input[type="password"],
input[type="text"],
input[type="number"],
input[type="file"] {
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 14px;
}

input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
}

button {
  background: #667eea;
  color: white;
  border: none;
  padding: 12px;
  border-radius: 5px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s;
}

button:hover {
  background: #764ba2;
}

button:active {
  transform: scale(0.98);
}

.dashboard {
  background: white;
  border-radius: 10px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.dashboard header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.dashboard h1 {
  font-size: 24px;
}

.user-info {
  font-size: 14px;
  display: flex;
  gap: 15px;
  align-items: center;
}

.user-info button {
  background: rgba(255, 255, 255, 0.2);
  padding: 8px 15px;
  font-size: 12px;
}

.user-info button:hover {
  background: rgba(255, 255, 255, 0.3);
}

main {
  padding: 30px;
}

h2 {
  color: #333;
  margin-bottom: 25px;
  font-size: 22px;
}

h3 {
  color: #667eea;
  margin-bottom: 15px;
  font-size: 16px;
}

section {
  margin-bottom: 30px;
}

.card {
  background: #f9f9f9;
  border-left: 4px solid #667eea;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
}

.card h4 {
  color: #333;
  margin-bottom: 10px;
}

.card p {
  color: #666;
  font-size: 14px;
  margin-bottom: 8px;
}

.card button {
  margin-right: 10px;
  margin-top: 10px;
  padding: 8px 15px;
  font-size: 12px;
}

.badge {
  display: inline-block;
  background: #667eea;
  color: white;
  padding: 4px 10px;
  border-radius: 3px;
  font-size: 12px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

table th {
  background: #f0f0f0;
  padding: 12px;
  text-align: left;
  font-weight: 600;
  color: #333;
  border-bottom: 2px solid #ddd;
}

table td {
  padding: 12px;
  border-bottom: 1px solid #ddd;
  color: #666;
}

a {
  color: #667eea;
  text-decoration: none;
  cursor: pointer;
}

a:hover {
  text-decoration: underline;
}

@media (max-width: 768px) {
  .dashboard header {
    flex-direction: column;
    gap: 15px;
  }
  
  .user-info {
    width: 100%;
    justify-content: space-between;
  }
  
  main {
    padding: 20px;
  }
}
</style>